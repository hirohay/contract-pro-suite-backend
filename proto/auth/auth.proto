syntax = "proto3";

package auth;

option go_package = "contract-pro-suite/proto/auth";

// AuthService 認証サービス
service AuthService {
  // GetMe 現在のユーザー情報を取得（認証必要）
  rpc GetMe(GetMeRequest) returns (GetMeResponse);
  // SignupClient サービス利用開始時のアカウント登録（認証不要）
  // 新規クライアント（企業）を登録し、同時にそのクライアントの管理者権限を持つユーザーを作成
  rpc SignupClient(SignupClientRequest) returns (SignupClientResponse);
  
  // クライアントユーザー管理
  // ListClientUsers クライアントユーザー一覧取得（認証必要、権限: users:READ）
  rpc ListClientUsers(ListClientUsersRequest) returns (ListClientUsersResponse);
  // GetClientUser クライアントユーザー詳細取得（認証必要、権限: users:READ）
  rpc GetClientUser(GetClientUserRequest) returns (GetClientUserResponse);
  // CreateClientUser クライアントユーザー作成（認証必要、権限: users:WRITE）
  rpc CreateClientUser(CreateClientUserRequest) returns (CreateClientUserResponse);
  // UpdateClientUser クライアントユーザー更新（認証必要、権限: users:WRITE）
  rpc UpdateClientUser(UpdateClientUserRequest) returns (UpdateClientUserResponse);
  // DeleteClientUser クライアントユーザー削除（認証必要、権限: users:DELETE）
  rpc DeleteClientUser(DeleteClientUserRequest) returns (DeleteClientUserResponse);
}

// GetMeRequest 現在のユーザー情報取得リクエスト
message GetMeRequest {
  // 空（認証情報はメタデータから取得）
}

// GetMeResponse 現在のユーザー情報取得レスポンス
message GetMeResponse {
  string user_id = 1;      // ユーザーID（UUID）
  string email = 2;        // メールアドレス
  string user_type = 3;    // ユーザータイプ（OPERATOR or CLIENT_USER）
  optional string client_id = 4; // クライアントID（UUID、オプション）
}

// SignupClientRequest サービス利用開始時のアカウント登録リクエスト
message SignupClientRequest {
  // クライアント情報
  string name = 1;                    // クライアント名（必須）
  optional string company_code = 2;   // 企業コード（オプション、JIPDEC標準企業コード、一意）
  string slug = 3;                    // スラッグ（必須、一意、サブドメイン用）
  optional string e_sign_mode = 4;   // 電子署名方式（オプション、デフォルト: WITNESS_OTP）
  optional int32 retention_default_months = 5; // データ保存期間（月、オプション、デフォルト: 84）
  optional string settings = 6;       // 設定（JSON文字列、オプション、デフォルト: {}）
  
  // 管理者ユーザー情報
  string admin_email = 10;           // 管理者メールアドレス（必須）
  string admin_password = 11;        // 管理者パスワード（必須）
  string admin_first_name = 12;      // 管理者名（必須）
  string admin_last_name = 13;       // 管理者姓（必須）
  optional string admin_department = 14; // 管理者部署（オプション）
  optional string admin_position = 15;   // 管理者役職（オプション）
}

// SignupClientResponse サービス利用開始時のアカウント登録レスポンス
message SignupClientResponse {
  string client_id = 1;      // クライアントID（UUID）
  string client_name = 2;   // クライアント名
  string admin_user_id = 3; // 管理者ユーザーID（UUID）
  string admin_email = 4;    // 管理者メールアドレス
}

// ListClientUsersRequest クライアントユーザー一覧取得リクエスト
message ListClientUsersRequest {
  int32 limit = 1;   // 取得件数（デフォルト: 50、最大: 100）
  int32 offset = 2;  // オフセット（デフォルト: 0）
}

// ListClientUsersResponse クライアントユーザー一覧取得レスポンス
message ListClientUsersResponse {
  repeated ClientUser users = 1;  // ユーザー一覧
  int32 total = 2;                // 総件数
}

// GetClientUserRequest クライアントユーザー詳細取得リクエスト
message GetClientUserRequest {
  string client_user_id = 1;  // クライアントユーザーID（UUID）
}

// GetClientUserResponse クライアントユーザー詳細取得レスポンス
message GetClientUserResponse {
  ClientUser user = 1;
}

// CreateClientUserRequest クライアントユーザー作成リクエスト
message CreateClientUserRequest {
  string email = 1;           // メールアドレス（必須）
  string password = 2;        // パスワード（必須）
  string first_name = 3;       // 名（必須）
  string last_name = 4;        // 姓（必須）
  optional string department = 5;  // 部署（オプション）
  optional string position = 6;      // 役職（オプション）
  optional string settings = 7;      // 設定（JSON文字列、オプション、デフォルト: {}）
}

// CreateClientUserResponse クライアントユーザー作成レスポンス
message CreateClientUserResponse {
  ClientUser user = 1;
}

// UpdateClientUserRequest クライアントユーザー更新リクエスト
message UpdateClientUserRequest {
  string client_user_id = 1;   // クライアントユーザーID（UUID、必須）
  optional string email = 2;   // メールアドレス（オプション）
  optional string first_name = 3;  // 名（オプション）
  optional string last_name = 4;   // 姓（オプション）
  optional string department = 5;  // 部署（オプション）
  optional string position = 6;    // 役職（オプション）
  optional string settings = 7;    // 設定（JSON文字列、オプション）
  optional string status = 8;       // ステータス（ACTIVE, INACTIVE, SUSPENDED、オプション）
}

// UpdateClientUserResponse クライアントユーザー更新レスポンス
message UpdateClientUserResponse {
  ClientUser user = 1;
}

// DeleteClientUserRequest クライアントユーザー削除リクエスト
message DeleteClientUserRequest {
  string client_user_id = 1;  // クライアントユーザーID（UUID）
}

// DeleteClientUserResponse クライアントユーザー削除レスポンス
message DeleteClientUserResponse {
  // 空（成功時のみ返却）
}

// ClientUser クライアントユーザー情報
message ClientUser {
  string client_user_id = 1;  // クライアントユーザーID（UUID）
  string client_id = 2;       // クライアントID（UUID）
  string email = 3;           // メールアドレス
  string first_name = 4;      // 名
  string last_name = 5;       // 姓
  optional string department = 6;  // 部署
  optional string position = 7;    // 役職
  string status = 8;          // ステータス（ACTIVE, INACTIVE, SUSPENDED）
  string settings = 9;         // 設定（JSON文字列）
  string created_at = 10;     // 作成日時（ISO 8601）
  string updated_at = 11;     // 更新日時（ISO 8601）
}

